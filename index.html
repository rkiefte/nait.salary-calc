<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA Salary & Retro Analyst</title>
    <style>
        :root { --blue: #004a99; --light: #e7f3ff; --success: #28a745; --text: #333; --warn: #f39c12; }
        body { font-family: -apple-system, sans-serif; background: #f0f4f8; color: var(--text); padding: 15px; margin: 0; }
        .container { max-width: 650px; margin: 20px auto; background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: var(--blue); text-align: center; font-size: 22px; margin-bottom: 5px; }
        .sub { text-align: center; color: #777; font-size: 13px; margin-bottom: 25px; }
        label { display: block; margin-bottom: 6px; font-weight: 700; font-size: 14px; color: var(--blue); }
        input, select { width: 100%; padding: 12px; border: 1.5px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; margin-bottom: 20px; }
        button { width: 100%; background: var(--blue); color: #fff; border: none; padding: 16px; border-radius: 8px; font-size: 18px; font-weight: 700; cursor: pointer; }
        button:hover { background: #003366; }
        .results { display: none; margin-top: 25px; border-top: 2px solid #eee; padding-top: 20px; }
        .card { padding: 15px; border-radius: 8px; margin-bottom: 15px; text-align: center; border: 1px solid #ddd; }
        .card-verify { background: #fff8e1; border-color: #ffe082; }
        .card-retro { background: #e8f5e9; border-color: #a5d6a7; }
        .tag { font-size: 10px; text-transform: uppercase; color: #777; font-weight: 800; display: block; margin-bottom: 4px; }
        .val { font-size: 24px; font-weight: 800; color: var(--blue); }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 12px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: left; }
        th { background: var(--light); color: var(--blue); }
        tr.highlight { background-color: #fcfcfc; font-weight: 600; border-left: 4px solid var(--success); }
        .retro-cell { color: var(--success); font-weight: bold; }
        .footer { text-align: center; margin-top: 30px; font-size: 14px; color: #555; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h1>NASA Salary Analyst</h1>
    <p class="sub">Precision 2024-2028 Financial Dashboard</p>
    
    <label>Hire Date (Anniversary Date)</label>
    <input type="date" id="hireDate">

    <label>Current Step</label>
    <select id="currStep">
        <option value="" disabled selected>Select your current step...</option>
        <option value="3">Step 3</option><option value="4">Step 4</option>
        <option value="5">Step 5</option><option value="6">Step 6</option>
        <option value="7">Step 7</option><option value="8">Step 8</option>
        <option value="9">Step 9</option><option value="10">Step 10</option>
        <option value="11">Step 11</option><option value="12">Step 12</option>
        <option value="13">Step 13</option><option value="14">Step 14</option>
        <option value="15">Step 15</option><option value="16">Step 16</option>
        <option value="17">Step 17</option>
    </select>

    <button onclick="calculate()">Run Financial Audit</button>

    <div id="results" class="results">
        <div class="card card-verify">
            <span class="tag">Verify Current Pay Stub (Old 2023 Grid)</span>
            <span class="val" id="outOld" style="color: #d35400;"></span>
            <small style="color:#888;">Matches the 2023-2024 Table Rate for your Current Step.</small>
        </div>

        <div class="card card-retro">
            <span class="tag">Total Estimated Retro Payout</span>
            <span class="val" id="outRetro" style="color: var(--success);"></span>
            <small style="color:#888;">Calculated strictly from Hire Date through June 30, 2026.</small>
        </div>

        <h3 style="font-size: 16px; color: var(--blue); margin-bottom: 10px;">Salary Trajectory & Retro Breakdown</h3>
        <table>
            <thead>
                <tr>
                    <th>Effective Date</th>
                    <th>Event</th>
                    <th>Step</th>
                    <th>Salary</th>
                    <th>Retro for Period</th>
                </tr>
            </thead>
            <tbody id="outTable"></tbody>
        </table>
    </div>

    <div class="footer">
        Brought to you by Russell... You're welcome.
    </div>
</div>

<script>
const grid = {
    3: [65544, 67510.32, 69535.63, 71621.70, 73770.35],
    4: [69007, 71077.21, 73209.53, 75405.81, 77667.99],
    5: [72469, 74643.07, 76882.36, 79188.83, 81564.50],
    6: [75931, 78208.93, 80555.20, 82971.85, 85461.01],
    7: [79393, 81774.79, 84228.03, 86754.87, 89357.52],
    8: [82856, 85341.68, 87901.93, 90538.99, 93255.16],
    9: [86319, 88908.57, 91575.83, 94323.10, 97152.79],
    10: [89781, 92474.43, 95248.66, 98106.12, 101049.31],
    11: [93244, 96041.32, 98922.56, 101890.24, 104946.94],
    12: [96706, 99607.18, 102595.40, 105673.26, 108843.45],
    13: [100169, 103174.07, 106269.29, 109457.37, 112741.09],
    14: [103632, 106740.96, 109943.19, 113241.48, 116638.73],
    15: [107094, 110306.82, 113616.02, 117024.51, 120535.24],
    16: [110557, 113873.71, 117289.92, 120808.62, 124432.88],
    17: [114019, 117439.57, 120962.76, 124591.64, 128329.39]
};

function calculate() {
    const cStepIn = parseInt(document.getElementById('currStep').value);
    const hStr = document.getElementById('hireDate').value;
    if (!cStepIn || !hStr) return alert("Select hire date and current step.");

    const hireDate = new Date(hStr + "T00:00:00");
    const today = new Date();
    const retroEnd = new Date("2026-06-30T23:59:59");
    const fmt = new Intl.NumberFormat('en-CA', { style: 'currency', currency: 'CAD' });
    const dateFmt = { month: 'short', day: 'numeric', year: 'numeric' };

    // Find starting step at hire date
    let yearsSinceHireAtToday = today.getFullYear() - hireDate.getFullYear();
    if (today.getMonth() < hireDate.getMonth() || (today.getMonth() === hireDate.getMonth() && today.getDate() < hireDate.getDate())) yearsSinceHireAtToday--;
    const startStep = Math.max(3, cStepIn - yearsSinceHireAtToday);

    function getStepAtDate(d) {
        let y = d.getFullYear() - hireDate.getFullYear();
        if (d.getMonth() < hireDate.getMonth() || (d.getMonth() === hireDate.getMonth() && d.getDate() < hireDate.getDate())) y--;
        return Math.min(17, startStep + Math.max(0, y));
    }

    // Surgical Retro loop: Only calculates for months AFTER hireDate
    function getRetroForWindow(start, end) {
        let total = 0;
        let audit = new Date(start);
        while (audit <= end) {
            // Check YYYY-MM to avoid precision issues
            const auditYM = audit.getFullYear() * 12 + audit.getMonth();
            const hireYM = hireDate.getFullYear() * 12 + hireDate.getMonth();
            
            if (auditYM >= hireYM) {
                let step = getStepAtDate(audit);
                let col = 0;
                if (audit >= new Date("2024-07-01") && audit < new Date("2025-07-01")) col = 1;
                else if (audit >= new Date("2025-07-01")) col = 2;
                
                if (col > 0) {
                    total += (grid[step][col] / 12) - (grid[step][0] / 12);
                }
            }
            audit.setMonth(audit.getMonth() + 1);
        }
        return total;
    }

    const retro2024 = getRetroForWindow(new Date("2024-07-01"), new Date("2025-06-30"));
    const retro2025 = getRetroForWindow(new Date("2025-07-01"), retroEnd);
    const totalRetro = retro2024 + retro2025;

    let tableHTML = "";
    // Row 1: Shows 2024 Increase Period
    tableHTML += `<tr class="highlight"><td>July 1, 2024</td><td>2024 Increase (3%)</td><td>Step ${getStepAtDate(new Date("2024-07-01"))}</td><td>${fmt.format(grid[getStepAtDate(new Date("2024-07-01"))][1])}</td><td class="retro-cell">${fmt.format(retro2024)}</td></tr>`;
    // Row 2: Shows 2025 Increase Period
    tableHTML += `<tr class="highlight"><td>July 1, 2025</td><td>2025 Increase (3%)</td><td>Step ${getStepAtDate(new Date("2025-07-01"))}</td><td>${fmt.format(grid[getStepAtDate(new Date("2025-07-01"))][2])}</td><td class="retro-cell">${fmt.format(retro2025)}</td></tr>`;
    
    const futureEvents = [
        { d: "2026-07-01", type: "2026 Increase (3%)", idx: 3 },
        { d: "2027-07-01", type: "2027 Increase (3%)", idx: 4 }
    ];
    for (let yr = 2026; yr <= 2027; yr++) {
        let anniv = new Date(hireDate);
        anniv.setFullYear(yr);
        futureEvents.push({ d: anniv.toISOString().split('T')[0], type: