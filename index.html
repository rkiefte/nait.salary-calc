<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA Salary & Retro Analyst</title>
    <style>
        :root { --blue: #004a99; --light: #e7f3ff; --success: #28a745; --text: #333; --warn: #f39c12; }
        body { font-family: -apple-system, sans-serif; background: #f0f4f8; color: var(--text); padding: 15px; margin: 0; }
        .container { max-width: 550px; margin: 20px auto; background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: var(--blue); text-align: center; font-size: 22px; margin-bottom: 5px; }
        .sub { text-align: center; color: #777; font-size: 13px; margin-bottom: 25px; }
        label { display: block; margin-bottom: 6px; font-weight: 700; font-size: 14px; color: var(--blue); }
        input, select { width: 100%; padding: 12px; border: 1.5px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; margin-bottom: 20px; }
        button { width: 100%; background: var(--blue); color: #fff; border: none; padding: 16px; border-radius: 8px; font-size: 18px; font-weight: 700; cursor: pointer; }
        button:hover { background: #003366; }
        .results { display: none; margin-top: 25px; border-top: 2px solid #eee; padding-top: 20px; }
        .card { padding: 15px; border-radius: 8px; margin-bottom: 15px; text-align: center; border: 1px solid #ddd; }
        .card-verify { background: #fff8e1; border-color: #ffe082; }
        .card-retro { background: #e8f5e9; border-color: #a5d6a7; }
        .tag { font-size: 10px; text-transform: uppercase; color: #777; font-weight: 800; display: block; margin-bottom: 4px; }
        .val { font-size: 24px; font-weight: 800; color: var(--blue); }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: left; }
        th { background: var(--light); color: var(--blue); }
        tr.anniversary { background-color: #f9f9f9; font-weight: 600; }
        .footer { text-align: center; margin-top: 30px; font-size: 14px; color: #555; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h1>NASA Salary Analyst</h1>
    <p class="sub">Verified 2024-2028 Payout Engine</p>
    
    <label>Date of Hire</label>
    <input type="date" id="hireDate">

    <label>Current Step</label>
    <select id="currStep">
        <option value="" disabled selected>Choose Step...</option>
        <option value="3">Step 3</option><option value="4">Step 4</option>
        <option value="5">Step 5</option><option value="6">Step 6</option>
        <option value="7">Step 7</option><option value="8">Step 8</option>
        <option value="9">Step 9</option><option value="10">Step 10</option>
        <option value="11">Step 11</option><option value="12">Step 12</option>
        <option value="13">Step 13</option><option value="14">Step 14</option>
        <option value="15">Step 15</option><option value="16">Step 16</option>
        <option value="17">Step 17</option>
    </select>

    <button onclick="calculate()">Analyze My Pay & Retro</button>

    <div id="results" class="results">
        <div class="card card-verify">
            <span class="tag">Verify Current Pay Stub (Gross Annual)</span>
            <span class="val" id="outOld" style="color: #d35400;"></span>
        </div>

        <div class="card card-retro">
            <span class="tag">Estimated Retro Payout (By June 30, 2026)</span>
            <span class="val" id="outRetro" style="color: var(--success);"></span>
        </div>

        <h3 style="font-size: 16px; color: var(--blue); margin-bottom: 10px;">Future Growth Trajectory</h3>
        <table>
            <thead><tr><th>Effective Date</th><th>Event</th><th>Step</th><th>Annual Salary</th></tr></thead>
            <tbody id="outTable"></tbody>
        </table>
    </div>

    <div class="footer">
        Brought to you by Russell... You're welcome.
    </div>
</div>

<script>
const grid = {
    3: [65544, 67510.32, 69535.63, 71621.70, 73770.35],
    4: [69007, 71077.21, 73209.53, 75405.81, 77667.99],
    5: [72469, 74643.07, 76882.36, 79188.83, 81564.50],
    6: [75931, 78208.93, 80555.20, 82971.85, 85461.01],
    7: [79393, 81774.79, 84228.03, 86754.87, 89357.52],
    8: [82856, 85341.68, 87901.93, 90538.99, 93255.16],
    9: [86319, 88908.57, 91575.83, 94323.10, 97152.79],
    10: [89781, 92474.43, 95248.66, 98106.12, 101049.31],
    11: [93244, 96041.32, 98922.56, 101890.24, 104946.94],
    12: [96706, 99607.18, 102595.40, 105673.26, 108843.45],
    13: [100169, 103174.07, 106269.29, 109457.37, 112741.09],
    14: [103632, 106740.96, 109943.19, 113241.48, 116638.73],
    15: [107094, 110306.82, 113616.02, 117024.51, 120535.24],
    16: [110557, 113873.71, 117289.92, 120808.62, 124432.88],
    17: [114019, 117439.57, 120962.76, 124591.64, 128329.39]
};

function calculate() {
    const currentStepInput = parseInt(document.getElementById('currStep').value);
    const hStr = document.getElementById('hireDate').value;
    if (!currentStepInput || !hStr) return alert("Please fill in both fields.");

    const hireDate = new Date(hStr + "T00:00:00");
    const today = new Date();
    const retroEndDate = new Date("2026-06-30T23:59:59");
    const fmt = new Intl.NumberFormat('en-CA', { style: 'currency', currency: 'CAD' });
    const dateFmt = { month: 'short', day: 'numeric', year: 'numeric' };

    // 1. Calculate the actual start step at time of hire
    let yearsSinceHireAtToday = today.getFullYear() - hireDate.getFullYear();
    if (today.getMonth() < hireDate.getMonth() || (today.getMonth() === hireDate.getMonth() && today.getDate() < hireDate.getDate())) yearsSinceHireAtToday--;
    const startStep = Math.max(3, currentStepInput - yearsSinceHireAtToday);

    function getStepAtDate(d) {
        let y = d.getFullYear() - hireDate.getFullYear();
        if (d.getMonth() < hireDate.getMonth() || (d.getMonth() === hireDate.getMonth() && d.getDate() < hireDate.getDate())) y--;
        return Math.min(17, startStep + Math.max(0, y));
    }

    // 2. Retro Calculation (Hire to June 30, 2026)
    let totalRetro = 0;
    let tempDate = new Date(hireDate);
    while (tempDate <= retroEndDate) {
        let stepAtDate = getStepAtDate(tempDate);
        let contractYearIndex = 0;
        
        if (tempDate >= new Date("2024-07-01") && tempDate < new Date("2025-07-01")) contractYearIndex = 1;
        else if (tempDate >= new Date("2025-07-01") && tempDate <= retroEndDate) contractYearIndex = 2;
        
        if (contractYearIndex > 0) {
            let paidMonthly = grid[stepAtDate][0] / 12;
            let shouldMonthly = grid[stepAtDate][contractYearIndex] / 12;
            totalRetro += (shouldMonthly - paidMonthly);
        }
        tempDate.setMonth(tempDate.getMonth() + 1);
    }

    // 3. Trajectory Table: Chronological Anniversary and July 1st logic
    let timeline = [];
    let nowStep = getStepAtDate(today);

    // Initial State (Ratified Today)
    timeline.push({ date: today, event: "Current (Ratified)", step: nowStep, index: 2 });

    // Identify Events through 2028
    const eventDates = [
        { d: "2026-07-01", type: "Economic (3%)", idx: 3 },
        { d: "2027-07-01", type: "Economic (3%)", idx: 4 }
    ];

    // Add Anniversaries
    for (let yr = 2026; yr <= 2028; yr++) {
        let anniv = new Date(hireDate);
        anniv.setFullYear(yr);
        timeline.push({ date: anniv, event: "Step Increase", step: getStepAtDate(anniv), anniversary: true });
    }

    // Add Economic Increases
    eventDates.forEach(ed => {
        let d = new Date(ed.d + "T00:00:00");
        timeline.push({ date: d, event: ed.type, step: getStepAtDate(d), index: ed.idx });
    });

    // Sort Chronologically
    timeline.sort((a, b) => a.date - b.date);

    let tableHTML = "";
    timeline.forEach(t => {
        if (t.date < today && t.event !== "Current (Ratified)") return;
        
        // Find correct salary index for anniversaries
        let salaryIdx = t.index;
        if (!salaryIdx) {
            if (t.date < new Date("2026-07-01")) salaryIdx = 2;
            else if (t.date < new Date("2027-07-01")) salaryIdx = 3;
            else salaryIdx = 4;
        }

        tableHTML += `<tr class="${t.anniversary ? 'anniversary' : ''}">
            <td>${t.date.toLocaleDateString('en-CA', dateFmt)}</td>
            <td>${t.event}</td>
            <td>Step ${t.step}</td>
            <td>${fmt.format(grid[t.step][salaryIdx])}</td>
        </tr>`;
    });

    document.getElementById('outOld').innerText = fmt.format(grid[nowStep][0]);
    document.getElementById('outRetro').innerText = fmt.format(totalRetro);
    document.getElementById('outTable').innerHTML = tableHTML;
    document.getElementById('results').style.display = "block";
}
</script>

</body>
</html>